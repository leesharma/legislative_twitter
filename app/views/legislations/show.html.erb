<div class="row">
  <div class="small-12 columns">

    <%= link_to "Download PDF",
                legislation_path(id: @legislation.id, format: 'pdf'),
                class: 'right button' %>

    <!-- Legislation Title -->
    <h2><%= @legislation.title.titleize %><br />
      <small><%= @legislation.created_at_time %></small>
    </h2>


    <!-- Action Buttons -->
    <%= link_to('Delete', legislation_path,
                method: "delete", class: 'right small alert button',
                data: { confirm: 'Are you sure you want to delete this?'}) %>
    <%= link_to 'Back', legislations_path, class:'right small button' %>
    <%= link_to 'Edit', edit_legislation_path(@legislation), class:'right small button' %>


    <!----- BEGIN CONTENT TABS ----->

    <!--Tab headers-->
    <ul class="tabs" data-tab>
      <li class="tab-title active"><a href="#fulltext_tab">Full Text</a></li>
      <% unless @attachments.empty? %>
          <li class='tab-title'><a href='#attachments_tab'>Attachments (<%= @attachments.count %>)</a></li>
      <% end %>
      <li class="tab-title"><a href="#changelog_tab">Changelog</a></li>
    </ul>

    <div class="tabs-content">

      <!--Legislation Full Text-->
      <div class="content active" id="fulltext_tab">
        <%= @legislation.body.html_safe %>
        <!--todo: how does this impact security?-->
      </div>

      <!-- Attachment List -->
      <div class="content" id="attachments_tab">
        <h4>Attached Material:</h4>
        <dl>
          <% @attachments.each do |attachment| %>
              <dt><%= link_to file_name(attachment), attachment.file.url %></dt>
              <dd><%= attachment.description %></dd>
          <% end %>
        </dl>
      </div>

      <!--Changelog Table-->
      <div class="content" id="changelog_tab">
        <p>
        <table width="100%" role="grid" summary="All changes (creates, updates, and destroys) to the legislation in question, including the attributes changed, the time changed, and links to a detailed diff and rollback button.">
          <caption>Legislation Changelog</caption>
          <thead>
          <tr>
            <th>Action</th>
            <th>Changed Attributes</th>
            <th>Time</th>
            <th>&Delta;</th>
            <th>Rollback</th>
          </tr>
          </thead>
          <tbody>
          <!--Diff Modal Cache-->
          <% cache [@changelog_cache_name, @latest_version] do %>
              <% @versions.each do |version| %>
                  <tr>
                    <td><%= version.event %></td>
                    <td><%= @legislation.list_changed_attributes version %></td>
                    <td><%= version.created_at.strftime("%-l:%M%P on %m/%d/%y") %></td>
                    <td><a href="#" data-no-turbolink data-reveal-id="diffModal<%=version.id%>">View Diff</a></td>
                    <td><%= link_to 'Rollback', revert_version_path(id: version.id),
                                    method: :post %></td>
                    <%= render 'application/diff_modal', version: version,
                               legislation: @legislation,
                               version_count: @version_count %>
                  </tr>
              <% end %>
          <% end %>
          </tbody>
        </table>
        </p>
      </div>
    </div>

    <!----- END CONTENT TABS ----->

  </div>
</div>
